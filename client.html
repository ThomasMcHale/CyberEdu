<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>CyberEDU</title>
</head>

<body>
	<div id="viewport">
	
	</div>
	<p id="text"> </p> 
</body>

<script src="/socket.io/socket.io.js"></script>
<script>
	var socket = io();
	
	var HTML_FOR_CANVAS = '<canvas id="view" width="1280" height="690" style="border:1px solid #000000; position:relative;" onclick="click_position()" onmousemove="rollover_position()"> </canvas>';
	document.getElementById('viewport').innerHTML = HTML_FOR_CANVAS;
	var CANVAS_ELEMENT = document.getElementById("view");

	// Debug print function. Prints messages to server console. May be useful.
	function print (s) {
		document.getElementById("text").innerHTML = document.getElementById("text").innerHTML + s + "<br>";
	}
	
	/* Grabs the script from the server and adds it to the document. 
	I know it works in IE. If this works in Firefox and Chrome as well, 
	we can hide the script from the user in this manner, so they cannot view source on it. */
	socket.on("script", function(info) {
	    var script = document.createElement("SCRIPT");
		script.src = 'data:;base64,' + info.buffer;
		document.body.appendChild(script);		
	});
	
	/* Grabs the resources from the server. Game starts when all resources have been downloaded. */
	var received_files = 0;
	var EXPECTED_FILES = 9;
	
	/*
		img_no	image
		0		Coffee Shop
		1		Start Screen
		2 		Inventory
		3		Mall
		4		FreePhoneSoftware.com
		5		HookMyPhoneUp.net
		6		OpenSourcePhones.org
		7		Blank Web Browser
	*/
	var img_list = [];
	socket.on("image", function(info) {
		var img = new Image();
		// Need to wait for image to load before drawing it
		img.onload = function () {
			received_files++;
			img_list[img.id] = img;
			if (received_files == EXPECTED_FILES)
				go();
		}
		img.src = 'data:image/jpeg;base64,' + info.buffer;
		img.id = info.image;
	});
	/*
		audio_no	sound
		0   		click
	*/
	var audio_list = [];
	socket.on("audio", function(info) {
		var sound = document.createElement("audio");
		sound.src = 'data:audio/wav;base64,' + info.buffer;
		sound.preload = "auto";
		received_files++;
		audio_list[info.audio] = sound;
		if (received_files == EXPECTED_FILES)
			go();
	});
	socket.emit('request_image');
	socket.emit('request_audio');
	
	socket.on("video", function(info) {
		var html_for_video = '<video width="640" height="480" controls><source src="data:video/mp4;base64,' + info.buffer+ '"</source></video>';
		html_for_video += '<button onclick="return_to_game()">Return To Game</button>';
		document.getElementById('viewport').innerHTML = html_for_video;
	});
	
	/* A video name is its file name, without the extension */
	function play_video (name) {
		document.getElementById('viewport').innerHTML = '<p>Loading video...</p>';
		socket.emit('request_video', name);
	}
</script>
</html>