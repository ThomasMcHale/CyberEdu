<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>CyberEDU</title>
	<link rel="shortcut icon" href="http://jrhansf.student.umd.edu/favicon"></link>
</head>

<body>
	<div id="viewport">
	
	</div>
	<p id="text"> </p> 
</body>

<script src="/socket.io/socket.io.js"></script>
<script>
	var SERVER_HOSTNAME = 'jrhansf.student.umd.edu';

	var socket = io.connect('http://' + SERVER_HOSTNAME);
	
	var HTML_FOR_CANVAS = '<canvas id="view" width="1280" height="630" style="border:1px solid #000000; position:relative;" onclick="click_position()" onmousemove="rollover_position()"> </canvas>';
	document.getElementById('viewport').innerHTML = HTML_FOR_CANVAS;
	var CANVAS_ELEMENT = document.getElementById("view");

	// Debug print function. Prints messages to server console. May be useful.
	function print (s) {
		document.getElementById("text").innerHTML = document.getElementById("text").innerHTML + s + "<br>";
	}
	
	/* Grabs the resources from the server. Game starts when all resources have been downloaded. */
	var received_files = 0;
	var EXPECTED_FILES = 27;
	
	/* Grabs the script from the server and adds it to the document. 
	I know it works in IE. If this works in Firefox and Chrome as well, 
	we can hide the script from the user in this manner, so they cannot view source on it. */
	socket.on("script", function(info) {
	    var script = document.createElement("SCRIPT");
		script.src = 'data:;base64,' + info.buffer;
		document.body.appendChild(script);
		received_files++;
		if (info.save_inbound) {
			EXPECTED_FILES += 1;
			print("Retrieving your save file, please be patient");
		}
		if (received_files == EXPECTED_FILES)
			go();
	});
	
	/*
		img_no	image
		0		Coffee Shop
		1		Start Screen
		2 		Inventory
		3		Mall
		4		FreePhoneSoftware.com
		5		HookMyPhoneUp.net
		6		OpenSourcePhones.org
		7		Blank Web Browser
		8		Account Registration Page
		9		404 Not Found
		10		Phone
		11		Phone Screen Off
		12		Phone Screen Home
		13		Phone Screen Install Software
		14		Web site for FreePhoneSoftware.com
		15		Web site for HookMyPhoneUp.net
		16		Web site for OpenSourcePhones.org
		17		Phone all programs screen
		18		Phone E-mail mailbox screen
		19		Library
		20		Librarian
		21		Computer with USB
		22		Computer with Python code
		23		Computer with Word doc
		24		Computer file system
	*/
	var img_list = [];
	socket.on("image", function(info) {
		var img = new Image();
		// Need to wait for image to load before drawing it
		img.onload = function () {
			received_files++;
			img_list[img.id] = img;
			if (received_files == EXPECTED_FILES)
				go();
		}
		img.src = 'data:image/jpeg;base64,' + info.buffer;
		img.id = info.image;
	});
	/*
		audio_no	sound
		0   		click
	*/
	var audio_list = [];
	socket.on("audio", function(info) {
		var sound = document.createElement("audio");
		sound.src = 'data:audio/wav;base64,' + info.buffer;
		sound.preload = "auto";
		received_files++;
		audio_list[info.audio] = sound;
		if (received_files == EXPECTED_FILES)
			go();
	});
	socket.emit('request_image');
	socket.emit('request_audio');
	
	/* A video name is its name on the server side. */
	function play_video (name) {
		var html_for_video = '<p><a href="http://localhost/' + name + '"' + '>Watch the Video!</a></p>';
		html_for_video += '<button onclick="return_to_game()">Return To Game</button>';
		document.getElementById('viewport').innerHTML = html_for_video
	}
</script>
</html>